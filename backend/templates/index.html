<!DOCTYPE html>
<html>
<head>
<title>Agentic AI Content Moderation System</title>

<style>

body{
    background:#0f172a;
    color:white;
    font-family:Arial;
    text-align:center;
}

.container{
    width:70%;
    margin:auto;
    margin-top:50px;
    padding:30px;
    background:#1e293b;
    border-radius:12px;
}

input{
    width:80%;
    padding:12px;
    border-radius:6px;
    border:none;
}

button{
    padding:12px 30px;
    margin-top:15px;
    background:#22c55e;
    color:black;
    font-size:16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

button:hover{
    opacity:0.9;
}

.results{
    margin-top:30px;
    text-align:left;
}

.normal{
    color:#22c55e;
    padding:8px;
}

.blocked{
    color:#ef4444;
    border-bottom:1px solid #334155;
    padding:10px;
}

.hash{
    font-size:12px;
    color:#facc15;
}

</style>
</head>

<body>

<h1>üîê Agentic AI Content Moderation System</h1>
<p>YouTube Link Analyzer</p>

<div class="container">

<input type="text" id="url" placeholder="Paste YouTube video link here">
<br>

<button onclick="analyze()">Analyze Link</button>
<br><br>

<button onclick="downloadReport()">Download Evidence Report (PDF)</button>

<!-- DASHBOARD -->
<div id="dashboard" style="margin-top:30px;"></div>

<!-- RESULTS -->
<div class="results" id="results"></div>

</div>

<script>

// ------------------------------
// ANALYZE LINK
// ------------------------------
async function analyze(){

    const url = document.getElementById("url").value.trim();

    if(url === ""){
        alert("Please paste a YouTube link");
        return;
    }

    const dashboard = document.getElementById("dashboard");
    const resultsDiv = document.getElementById("results");

    dashboard.innerHTML = "<p>‚è≥ Analyzing...</p>";
    resultsDiv.innerHTML = "";

    try{

        const response = await fetch(
            "http://127.0.0.1:8000/api/analyze-link/?url=" 
            + encodeURIComponent(url)
        );

        const data = await response.json();

        if(data.error){
            dashboard.innerHTML = "";
            resultsDiv.innerHTML = data.error;
            return;
        }

        // ---------------------------
        // DASHBOARD
        // ---------------------------
        const s = data.summary;

        dashboard.innerHTML = `
            <h2>üìä Dashboard Summary</h2>
            <p>Total Comments: ${s.total_comments}</p>
            <p>Normal: ${s.normal}</p>
            <p>Abusive: ${s.abusive}</p>
            <p>Cyberbullying: ${s.cyberbullying}</p>
            <p>Hate Speech: ${s.hate_speech}</p>
            <p>Total Flagged: ${s.total_flagged}</p>
            <hr>
        `;

        // ---------------------------
        // RESULTS
        // ---------------------------
        data.results.forEach(item => {

            if(item.prediction === "NORMAL"){
                resultsDiv.innerHTML += `
                    <p class="normal">
                        ‚úî ${item.text}
                    </p>
                `;
            }
            else{
                resultsDiv.innerHTML += `
                    <p class="blocked">
                        ‚ö† ${item.text}<br>
                        <b>${item.prediction}</b><br>
                        Confidence: ${item.confidence}<br>
                        Severity Score: ${item.severity_score}<br>
                        Risk Level: ${item.risk_level}<br>
                        Hash: ${item.hash}<br>
                        Time: ${item.timestamp}
                    </p>
                `;
            }

        });

    }
    catch(err){
        console.error(err);
        alert("Backend connection failed");
    }
}


// ------------------------------
// DOWNLOAD PDF
// ------------------------------
function downloadReport(){

    const url = document.getElementById("url").value.trim();

    if(url === ""){
        alert("Paste YouTube link first");
        return;
    }

    window.open(
        "http://127.0.0.1:8000/api/download-report/?url=" 
        + encodeURIComponent(url)
    );
}

</script>

</body>
</html>
